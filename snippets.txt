## New Post Modal for layout.html
<!-- NOTE: Once auth is set up, this button will only be visible when logged in -->
<button class="btn btn-outline-light mb-2 mb-md-0 me-md-2"
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#createPostModal">New Post</button>
<!-- NOTE: Once auth is set up, this button will only be visible when logged in -->



## Create Post Modal
<!-- Create Post Modal -->
<div class="modal fade"
        id="createPostModal"
        tabindex="-1"
        aria-labelledby="createPostModalLabel"
        aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="createPostModalLabel">New Post</h5>
        <button type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"></button>
        </div>
        <form id="createPostForm">
        <div class="modal-body">
            <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" id="title" name="title" required>
            </div>
            <div class="mb-3">
            <label for="content" class="form-label">Content</label>
            <textarea class="form-control" id="content" name="content" rows="5" required></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button"
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Post</button>
        </div>
        </form>
    </div>
    </div>
</div>



## Success and Error Modals
<!-- Success Modal -->
<div class="modal fade"
        id="successModal"
        tabindex="-1"
        aria-labelledby="successModalLabel"
        aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="successModalLabel">Success</h5>
        <button type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"></button>
        </div>
        <div class="modal-body">
        <p id="successMessage" class="fs-5"></p>
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
    </div>
</div>

<!-- Error Modal -->
<div class="modal fade"
        id="errorModal"
        tabindex="-1"
        aria-labelledby="errorModalLabel"
        aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="errorModalLabel">Error</h5>
        <button type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"></button>
        </div>
        <div class="modal-body">
        <p id="errorMessage" class="fs-5"></p>
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
    </div>
</div>



## utils.js
// Error message extraction from API responses
export function getErrorMessage(error) {
  if (typeof error.detail === "string") {
    return error.detail;
  } else if (Array.isArray(error.detail)) {
    return error.detail.map((err) => err.msg).join(". ");
  }
  return "An error occurred. Please try again.";
}

// Show a Bootstrap modal by ID
export function showModal(modalId) {
  const modal = bootstrap.Modal.getOrCreateInstance(
    document.getElementById(modalId),
  );
  modal.show();
  return modal;
}

// Hide a Bootstrap modal by ID
export function hideModal(modalId) {
  const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
  if (modal) modal.hide();
}



## Create Post JavaScript
<!-- Create Post Form Handler -->
<script type="module">
    import {
    getErrorMessage,
    hideModal,
    showModal,
    } from "/static/js/utils.js";

    const createForm = document.getElementById("createPostForm");

    createForm.addEventListener("submit", async (event) => {
    // Stop default form submission - we'll handle it with JavaScript
    event.preventDefault();

    // Gather form values into a plain object {title: "...", content: "..."}
    const formData = new FormData(createForm);
    const postData = Object.fromEntries(formData.entries());

    // TEMPORARY - hardcoded until authorization (Tutorial 11)
    postData.user_id = 1;

    try {
        // POST to our API as JSON
        const response = await fetch("/api/posts", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(postData),
        });

        if (response.ok) {
        const data = await response.json();
        document.getElementById("successMessage").textContent =
            `Post "${data.title}" created successfully!`;

        hideModal("createPostModal");
        showModal("successModal");

        // Clear form
        createForm.reset();

        // Reload page after modal is hidden to show new post
        document
            .getElementById("successModal")
            .addEventListener(
            "hidden.bs.modal",
            () => {
                window.location.reload();
            },
            { once: true },
            );
        } else {
        const error = await response.json();
        document.getElementById("errorMessage").textContent =
            getErrorMessage(error);

        hideModal("createPostModal");
        showModal("errorModal");
        }
    } catch (error) {
        document.getElementById("errorMessage").textContent =
        "Network error. Please check your connection and try again.";
        showModal("errorModal");
    }
    });
</script>

{% block scripts %}
{% endblock scripts %}



## Edit/Delete Single Post
<!-- Only show edit/delete options if user_id is 1 (TEMPORARY - until authentication) -->
{% if post.user_id == 1 %}
    <div class="post-actions mt-3 pt-3 border-top">
    <button type="button"
            class="btn btn-outline-secondary me-1"
            data-bs-toggle="modal"
            data-bs-target="#editModal">Edit Post</button>
    <button type="button"
            class="btn btn-outline-danger"
            data-bs-toggle="modal"
            data-bs-target="#deleteModal">Delete Post</button>
    </div>
{% endif %}



## Edit Post Modal
<!-- Edit Post Modal -->
<div class="modal fade"
     id="editModal"
     tabindex="-1"
     aria-labelledby="editModalLabel"
     aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Edit Post</h5>
        <button type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"></button>
      </div>
      <form id="editPostForm">
        <div class="modal-body">
          <input type="hidden" name="post_id" value="{{ post.id }}">
          <div class="mb-3">
            <label for="editTitle" class="form-label">Title</label>
            <input type="text"
                   class="form-control"
                   id="editTitle"
                   name="title"
                   value="{{ post.title }}"
                   required>
          </div>
          <div class="mb-3">
            <label for="editContent" class="form-label">Content</label>
            <textarea class="form-control"
                      id="editContent"
                      name="content"
                      rows="5"
                      required>{{ post.content }}</textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button"
                  class="btn btn-outline-secondary"
                  data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>



## Delete Confirmation Modal
<!-- Delete Confirmation Modal -->
<div class="modal fade"
     id="deleteModal"
     tabindex="-1"
     aria-labelledby="deleteModalLabel"
     aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteModalLabel">Delete Post?</h5>
        <button type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="fs-5">Are you sure you want to delete this post? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button"
                class="btn btn-outline-secondary"
                data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>
</div>



## Edit/Delete JavaScript
{% block scripts %}
  <script type="module">
    import {
      getErrorMessage,
      hideModal,
      showModal,
    } from "/static/js/utils.js";

    // Get post ID from Jinja2 template
    const postId = {{ post.id }};

    // Edit Post Form Handler
    const editForm = document.getElementById("editPostForm");
    editForm.addEventListener("submit", async (event) => {
      // Stop default form submission - we'll handle it with JavaScript
      event.preventDefault();

      // Gather form values into a plain object
      const formData = new FormData(editForm);
      const postData = Object.fromEntries(formData.entries());

      // Remove post_id from data (it's in the URL, not the body)
      delete postData.post_id;

      try {
        // PATCH for partial update (just title and content, not user_id)
        const response = await fetch(`/api/posts/${postId}`, {
          method: "PATCH",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(postData),
        });

        if (response.ok) {
          document.getElementById("successMessage").textContent =
            "Post updated successfully!";

          hideModal("editModal");
          showModal("successModal");

          document
            .getElementById("successModal")
            .addEventListener(
              "hidden.bs.modal",
              () => {
                window.location.reload();
              },
              { once: true },
            );
        } else {
          const error = await response.json();
          document.getElementById("errorMessage").textContent =
            getErrorMessage(error);

          hideModal("editModal");
          showModal("errorModal");
        }
      } catch (error) {
        document.getElementById("errorMessage").textContent =
          "Network error. Please check your connection and try again.";
        showModal("errorModal");
      }
    });

    // Delete Post Handler - listen for click on delete button
    const deleteButton = document.getElementById("confirmDelete");
    deleteButton.addEventListener("click", async () => {
      try {
        // DELETE request - no body needed, post_id is in the URL
        const response = await fetch(`/api/posts/${postId}`, {
          method: "DELETE",
        });

        // 204 = No Content (success)
        if (response.status === 204) {
          // Post is gone, redirect to home page
          window.location.href = "/";
        } else {
          const error = await response.json();
          document.getElementById("errorMessage").textContent =
            getErrorMessage(error);

          hideModal("deleteModal");
          showModal("errorModal");
        }
      } catch (error) {
        document.getElementById("errorMessage").textContent =
          "Network error. Please check your connection and try again.";
        showModal("errorModal");
      }
    });
  </script>
{% endblock scripts %}